<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main-layout}" th:with="activeTab='review', title='복덕복덕 : Review'">
<head>

    <style>
        #like:hover{
            border:0; outline: 0;
        }
        .photo_image{
            filter: invert(69%) sepia(25%) saturate(146%) hue-rotate(159deg) brightness(95%) contrast(92%);
        }

    </style>

    <script th:inline="javascript">
        $(document).ready(function (){
            $(".like").click(function (){ // 좋아요 하는 기능
                let data = $(this).val();
                $.ajax({
                    type: 'GET',
                    url:'/review/list/like',
                    data: { "id" : data},
                    dataType: 'json',
                    success: function (result){
                        if (result.resultCode == "error.auth") {
                            alert(result.message);
                        }else if(result.resultCode == "error.invalid"){
                            alert(result.message);
                        }else if(result.resultCode == "ok"){
                            $("#"+data).attr("src","/images/like_red.svg");
                            $('#likeNum'+data).html("좋아요 " + result.likeCheck);
                        }else if(result.resultCode == "duplicate"){
                            $("#"+data).attr("src","/images/like.svg");
                            $('#likeNum'+data).text("좋아요 " + result.likeCheck);
                        }
                    }
                });
            });
        });


    </script>

</head>
<body>
<div layout:fragment="content">

    <div class="container">
        <main>
            <div class="py-5 text-center">
                <h2>리뷰 리스트</h2>
            </div>

            <form class="justify-content-center" method="get" th:action="@{/review/search}">

                <!-- 검색창 -->
                <div class="form-group d-flex justify-content-center row">
                    <input type="text" class="form-control form-control-lg col-6" id="searchText" name="searchText"
                           placeholder="키워드 및 태그 검색" value=""
                           th:value="${param.searchText == null} ? '' : ${param.searchText}">
                    <button type="submit" class="btn btn-info col-1">검색</button>
                </div>

                <!-- 옵션 -->
                <div id="check_option" class="form-group form-check form-check-inline">
                    <details>
                        <summary> 검색 옵션 설정하기</summary>

                        <p id="search_address">
                            <span> 지역 : </span>
                            <input type="text" class="form-control" id="address"
                                   name="address" placeholder="동을 입력하세요. 예) 연희동"
                                   th:value="${param.address == null} ? '' : ${param.address}" value="">
                        </p>

                        <p id="check_roomsize" th:name="checkbox">
                            <span> 방 형태 : </span>
                            <input class="form-check-input" type="checkbox" id="r1" name="roomSize" value="ONEROOM"
                            />
                            <label class="form-check-label" for="r1"> 원룸 </label>

                            <input class="form-check-input" type="checkbox" id="r2" name="roomSize" value="TWOROOM"
                            />
                            <label class="form-check-label" for="r2"> 투룸 </label>

                            <input class="form-check-input" type="checkbox" id="r3" name="roomSize" value="THREEMORE"
                            />
                            <label class="form-check-label" for="r3"> 쓰리룸이상 </label>
                        </p>

                        <p id="check_structure">
                            <span> 주거 형태 : </span>
                            <input class="form-check-input" type="checkbox" id="st1" name="structure" value="VILLA"/>
                            <label class="form-check-label" for="st1"> 빌라 </label>

                            <input class="form-check-input" type="checkbox" id="st2" name="structure" value="OFFICE"/>
                            <label class="form-check-label" for="st2"> 오피스텔 </label>

                            <input class="form-check-input" type="checkbox" id="st3" name="structure" value="APART"/>
                            <label class="form-check-label" for="st3"> 아파트 </label>
                        </p>

                        <p id="check_payment">
                            <span> 주거 형태 : </span>
                            <input class="form-check-input" type="checkbox" id="p1" name="payment" value="MONTHLY"/>
                            <label class="form-check-label" for="p1"> 월세 </label>

                            <input class="form-check-input" type="checkbox" id="p2" name="payment" value="HALFCHARTER"/>
                            <label class="form-check-label" for="p2"> 반전세 </label>

                            <input class="form-check-input" type="checkbox" id="p3" name="payment" value="CHARTER"/>
                            <label class="form-check-label" for="p3"> 전세 </label>

                            <input class="form-check-input" type="checkbox" id="p4" name="payment" value="DEALING"/>
                            <label class="form-check-label" for="p4"> 매매 </label>
                        </p>

                        <p id="check_traffic">
                            <span> 가까운 교통편 : </span>
                            <input class="form-check-input" type="checkbox" id="t1" name="traffic" value="BUS"/>
                            <label class="form-check-label" for="t1"> 버스 </label>

                            <input class="form-check-input" type="checkbox" id="t2" name="traffic" value="SUBWAY"/>
                            <label class="form-check-label" for="t2"> 지하철 </label>
                        </p>

                        <p id="check_electronicDevices">
                            <span> 가구 옵션 : </span>
                            <input class="form-check-input" type="checkbox" id="e1" name="electronicDevice"
                                   value="BED"/>
                            <label class="form-check-label" for="e1"> 침대 </label>

                            <input class="form-check-input" type="checkbox" id="e2" name="electronicDevice"
                                   value="AIRCONDITIONER"/>
                            <label class="form-check-label" for="e2"> 에어컨 </label>

                            <input class="form-check-input" type="checkbox" id="e3" name="electronicDevice"
                                   value="WASHINGMACHINE"/>
                            <label class="form-check-label" for="e3"> 세탁기 </label>

                            <input class="form-check-input" type="checkbox" id="e4" name="electronicDevice"
                                   value="REFRIGERATOR"/>
                            <label class="form-check-label" for="e4"> 냉장고 </label>
                        </p>

                        <p id="check_welfare">
                            <span> 건물 시설 : </span>
                            <input class="form-check-input" type="checkbox" id="w1" name="welfare" value="PARKING"/>
                            <label class="form-check-label" for="w1"> 주차장 </label>

                            <input class="form-check-input" type="checkbox" id="w2" name="welfare" value="DELIVERYBOX"/>
                            <label class="form-check-label" for="w2"> 무인택배함 </label>

                            <input class="form-check-input" type="checkbox" id="w3" name="welfare" value="CCTV"/>
                            <label class="form-check-label" for="w3"> CCTV </label>
                        </p>

                        <p id="check_convenient">
                            <span> 편의 시설 : </span>
                            <input class="form-check-input" type="checkbox" id="c1" name="convenient" value="STORE"/>
                            <label class="form-check-label" for="c1"> 편의점 </label>

                            <input class="form-check-input" type="checkbox" id="c2" name="convenient" value="HOSPITAL"/>
                            <label class="form-check-label" for="c2"> 병원 </label>

                            <input class="form-check-input" type="checkbox" id="c3" name="convenient"
                                   value="COINLAUNDRY"/>
                            <label class="form-check-label" for="c3"> 코인빨래방 </label>
                        </p>
                    </details>
                </div>

                <!-- 정렬 -->
                <div class="form-group d-flex justify-content-end" id="line_option" style="float: right">

                    <input type="checkbox" id="photoReview" name="photoReview" value="true"/>
                    <label for="photoReview"> 포토리뷰만 보기 </label>

                    <select id="lineUp" name="lineUp" class="form-control">
                        <option name="sort" value="new" }>최신순</option>
                        <option name="sort" value="star" }>별점순</option>
                        <option name="sort" value="like">좋아요순</option>
                    </select>
                </div>

                <!-- 글쓰기 -->
                <div id="review_write" class="container justify-content-end">
                    <a class="btn btn-outline-info" th:href="@{/review/writeReview}">글쓰기</a>
                </div>


                <!-- 리뷰 리스트 -->
                <div class="container" th:text="'총 게시물 수 : '+${reviewList.totalElements}"></div>

                <div th:if="${reviewList.isEmpty()}" style="text-align: center;">
                    <h2>검색결과가 없습니다.</h2>
                </div>

                <div class="table" id="review_table" th:each="review : ${reviewList}" th:object="${review}">


                    <table class="table table-borderless wd-100">
                        <tr>
                            <td colspan="5" th:text="*{address} + '  '+ *{detailAddress}"> 주소</td>
                        </tr>

                        <tr>

                            <td rowspan="4" style="width: 400px; height: 200px">
                                <div th:if="*{#lists.isEmpty(uploadImage)}"
                                     style="display: table; width: 400px; height: 200px">
                                    <a th:href="@{/review/read(id=*{id})}" th:value="*{id}" class="review_read"
                                       style="text-decoration-line: none; color:black;">
                                        <div style="display: table-cell; text-align: center; vertical-align: middle; ">
                                            <img th:src="@{/images/no_photo.svg}" style="width: 350px; height: 200px;"
                                                 class="photo_image"/>
                                        </div>
                                    </a>
                                </div>
                                <div th:unless="*{#lists.isEmpty(uploadImage)}"
                                     style="display: table; width: 400px; height: 200px">
                                    <a th:href="@{/review/read(id=*{id})}" th:value="*{id}" class="review_read"
                                       style="text-decoration-line: none; color:black;">
                                        <div style="display: table-cell; text-align: center; vertical-align: middle; ">
                                            <img th:src="@{*{uploadImage[0].imagePath}}"
                                                 style="width: 350px; height: 200px;"
                                                 class="photo_image"/>
                                        </div>
                                    </a>
                                </div>
                            </td>

                            <td colspan="2">
                                <a th:href="@{/review/read(id=*{id})}" th:value="*{id}" class="review_read"
                                   style="text-decoration-line: none; color:black;">
                                    <span th:text="*{postName} + '&nbsp;&nbsp;'" style="font-size: 23px;"/>
                                    <span th:text="*{#temporals.format(regdate, 'yyyy-MM-dd')}"
                                          style="font-size: 15px; color: grey"/>
                                </a>
                            </td>

                            <td rowspan="4">
                                <div style="text-align: center">
                                    <p th:text="*{hit}" style="font-size : 40px; "/>
                                    조회
                                </div>
                            </td>
                            <td rowspan="4">
                                <div style="text-align: center" id="like_div">
                                    <button type="button" class="like"
                                            style="border:0px; outline:0px;background-color:transparent;"
                                            th:id="like" th:value="*{id}">
                                        <img th:src="@{ ${member?.likes?.contains(review)} ? '/images/like_red.svg' : '/images/like.svg'}"
                                             th:id="*{id}" width="50px" height="75px"></button>
                                    <p th:text="'좋아요 '+ *{likers.size}" th:id="likeNum + *{id}"/>

                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" th:if="*{star} == 0">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                            </td>
                            <td colspan="2" th:if="*{star} == 1">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                            </td>
                            <td colspan="2" th:if="*{star} == 2">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                            </td>
                            <td colspan="2" th:if="*{star} == 3">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                            </td>
                            <td colspan="2" th:if="*{star} == 4">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star.svg}" width="20px" height="20px">
                            </td>
                            <td colspan="2" th:if="*{star} == 5">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                                <img th:src="@{~/images/star_yellow.svg}" width="20px" height="20px">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" th:text="*{comment}"> 코멘트</td>
                        </tr>
                        <tr>
                            <td colspan="2">

                                <span th:if="*{tags != null}" th:each="t:*{tags}">
                                    <span th:text="${t.tagName}" style="background-color: #eeeeee"></span>
                                </span>
                                <span th:if="*{tags == null}">
                                <span th:text="등록된 태그가 없습니다"></span>
                                </span>

                            </td>
                        </tr>
                    </table>

                    <hr class="col-12 my-4">
                </div>
    </div>


    </form>

    <!-- 페이징 -->
    <div th:unless="${reviewList.isEmpty()}">
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${1 == reviewList.pageable.pageNumber + 1} ? 'disabled'">
                    <a class="page-link" href="#"
                       th:href="@{/review/list(page=${reviewList.pageable.pageNumber - 1},searchText=${param.searchText})}"
                       tabindex="-1" aria-disabled="true"> &lt; </a>
                </li>
                <li class="page-item" th:classappend="${i == reviewList.pageable.pageNumber+1} ? 'active'"
                    th:each="i : ${#numbers.sequence(startPage, endPage)}">
                    <a class="page-link" href="#"
                       th:href="@{/review/list(page=${i - 1},searchText=${param.searchText})}" th:text="${i}">1</a>
                </li>
                <li class="page-item"
                    th:classappend="${reviewList.totalPages == reviewList.pageable.pageNumber + 1} ? 'disabled'">
                    <a class="page-link" href="#"
                       th:href="@{/review/list(page=${reviewList.pageable.pageNumber + 1},searchText=${param.searchText})}">
                        &gt; </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- 무한 스크롤 -->
    <div id="add_scroll">

    </div>

    </main>
</div>
</div>

</body>
</html>